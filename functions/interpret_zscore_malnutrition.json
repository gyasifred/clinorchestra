{
  "name": "interpret_zscore_malnutrition",
  "code": "def interpret_zscore_malnutrition(zscore: float, measurement_type: str) -> str:\n    \"\"\"\n    Interpret z-score for malnutrition assessment following WHO/ASPEN criteria.\n\n    WHO Malnutrition Classification:\n    - Weight-for-height or BMI-for-age:\n      * z < -3: Severe acute malnutrition\n      * -3 \u2264 z < -2: Moderate acute malnutrition\n      * -2 \u2264 z < -1: Mild malnutrition risk\n      * -1 \u2264 z \u2264 +1: Normal\n      * z > +2: Overweight/obesity\n\n    - Height-for-age (stunting):\n      * z < -2: Stunted (chronic malnutrition)\n      * z < -3: Severely stunted\n\n    Args:\n        zscore: Z-score value\n        measurement_type: Type of growth measurement\n\n    Returns:\n        Clinical interpretation with severity and recommendations\n    \"\"\"\n    measurement_type = measurement_type.lower().replace(\" \", \"-\")\n\n    # Normalize measurement type\n    if \"weight\" in measurement_type and (\"height\" in measurement_type or \"length\" in measurement_type):\n        category = \"weight-for-height\"\n    elif \"bmi\" in measurement_type:\n        category = \"bmi\"\n    elif \"height\" in measurement_type or \"length\" in measurement_type:\n        category = \"height-for-age\"\n    elif \"weight\" in measurement_type:\n        category = \"weight-for-age\"\n    else:\n        category = \"unknown\"\n\n    # Interpret based on category and z-score\n    if category in [\"weight-for-height\", \"bmi\"]:\n        if zscore < -3:\n            severity = \"Severe Acute Malnutrition\"\n            interpretation = f\"Z-score {zscore:.2f} indicates SEVERE ACUTE MALNUTRITION (<-3 SD). Immediate intervention required. Risk of mortality increased.\"\n            percentile = zscore_to_percentile(zscore)\n            interpretation += f\" (Below {percentile:.1f}th percentile)\"\n        elif zscore < -2:\n            severity = \"Moderate Acute Malnutrition\"\n            interpretation = f\"Z-score {zscore:.2f} indicates MODERATE ACUTE MALNUTRITION (-3 to -2 SD). Nutritional intervention needed.\"\n            percentile = zscore_to_percentile(zscore)\n            interpretation += f\" (Approximately {percentile:.1f}th percentile)\"\n        elif zscore < -1:\n            severity = \"Mild Malnutrition Risk\"\n            interpretation = f\"Z-score {zscore:.2f} indicates MILD MALNUTRITION RISK (-2 to -1 SD). Monitor closely and consider intervention.\"\n            percentile = zscore_to_percentile(zscore)\n            interpretation += f\" (Approximately {percentile:.1f}th percentile)\"\n        elif zscore <= 1:\n            severity = \"Normal\"\n            interpretation = f\"Z-score {zscore:.2f} is NORMAL (-1 to +1 SD).\"\n            percentile = zscore_to_percentile(zscore)\n            interpretation += f\" (Approximately {percentile:.1f}th percentile)\"\n        elif zscore <= 2:\n            severity = \"Possible Overweight\"\n            interpretation = f\"Z-score {zscore:.2f} indicates POSSIBLE OVERWEIGHT (+1 to +2 SD).\"\n            percentile = zscore_to_percentile(zscore)\n            interpretation += f\" (Approximately {percentile:.1f}th percentile)\"\n        else:\n            severity = \"Obesity Risk\"\n            interpretation = f\"Z-score {zscore:.2f} indicates OBESITY RISK (>+2 SD). Assess for overnutrition.\"\n            percentile = zscore_to_percentile(zscore)\n            interpretation += f\" (Above {percentile:.1f}th percentile)\"\n\n    elif category == \"height-for-age\":\n        if zscore < -3:\n            severity = \"Severe Stunting\"\n            interpretation = f\"Z-score {zscore:.2f} indicates SEVERE STUNTING (<-3 SD). Chronic malnutrition.\"\n        elif zscore < -2:\n            severity = \"Stunting\"\n            interpretation = f\"Z-score {zscore:.2f} indicates STUNTING (-3 to -2 SD). Chronic undernutrition.\"\n        elif zscore < -1:\n            severity = \"Risk of Stunting\"\n            interpretation = f\"Z-score {zscore:.2f} indicates RISK OF STUNTING (-2 to -1 SD). Monitor growth.\"\n        else:\n            severity = \"Normal Height\"\n            interpretation = f\"Z-score {zscore:.2f} indicates NORMAL HEIGHT-FOR-AGE (\u2265-1 SD).\"\n\n    elif category == \"weight-for-age\":\n        if zscore < -3:\n            severity = \"Severe Underweight\"\n            interpretation = f\"Z-score {zscore:.2f} indicates SEVERE UNDERWEIGHT (<-3 SD). Immediate assessment needed.\"\n        elif zscore < -2:\n            severity = \"Underweight\"\n            interpretation = f\"Z-score {zscore:.2f} indicates UNDERWEIGHT (-3 to -2 SD). Nutritional support needed.\"\n        elif zscore < -1:\n            severity = \"Mild Underweight Risk\"\n            interpretation = f\"Z-score {zscore:.2f} indicates MILD UNDERWEIGHT RISK (-2 to -1 SD).\"\n        else:\n            severity = \"Normal Weight\"\n            interpretation = f\"Z-score {zscore:.2f} indicates NORMAL WEIGHT-FOR-AGE (\u2265-1 SD).\"\n\n    else:\n        interpretation = f\"Z-score {zscore:.2f} for {measurement_type}. Unable to classify - measurement type not recognized.\"\n\n    return interpretation\n\ndef zscore_to_percentile(zscore: float) -> float:\n    \"\"\"Helper function for percentile conversion\"\"\"\n    common_mappings = {\n        -3.0: 0.13, -2.5: 0.62, -2.33: 1.0, -2.0: 2.3, -1.88: 3.0,\n        -1.64: 5.0, -1.28: 10.0, -1.0: 15.9, -0.67: 25.0, 0.0: 50.0,\n        0.67: 75.0, 1.0: 84.1, 1.28: 90.0, 1.64: 95.0, 1.88: 97.0,\n        2.0: 97.7, 2.33: 99.0, 3.0: 99.87\n    }\n\n    if zscore in common_mappings:\n        return common_mappings[zscore]\n\n    z_keys = sorted(common_mappings.keys())\n    if zscore <= z_keys[0]:\n        return common_mappings[z_keys[0]]\n    if zscore >= z_keys[-1]:\n        return common_mappings[z_keys[-1]]\n\n    for i in range(len(z_keys) - 1):\n        if z_keys[i] <= zscore <= z_keys[i+1]:\n            z1, z2 = z_keys[i], z_keys[i+1]\n            p1, p2 = common_mappings[z1], common_mappings[z2]\n            proportion = (zscore - z1) / (z2 - z1)\n            return p1 + proportion * (p2 - p1)\n\n    return 50.0\n",
  "description": "Interpret z-score for malnutrition severity classification (WHO/ASPEN criteria). Returns clinical interpretation and severity level.",
  "parameters": {
    "zscore": {
      "type": "number",
      "description": "Z-score for weight-for-age, height-for-age, or weight-for-height/BMI"
    },
    "measurement_type": {
      "type": "string",
      "description": "Type of measurement: 'weight-for-age', 'height-for-age', 'weight-for-height', or 'BMI-for-age'"
    }
  },
  "returns": {
    "type": "string",
    "description": "Clinical interpretation with severity classification"
  },
  "enabled": true,
  "signature": "(zscore: float, measurement_type: str) -> str"
}